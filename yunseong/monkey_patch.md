# 몽키패치 보다는 안전한 타입을 사용하기

자바스크립트의 특징 중 하나는, 객체와 클래스에 임의의 속성을 추가할 수 있을 만큼 유연하다는점이다.

객체에 속성을 추가할 수 있는 기능은 종종 웹페이지에서 window나 document에 값을 할당해 전역변수를 만드는데 사용된다.

물론 특정 모던한 라이브러리나 프레임워크(React 등. jQuery는 제외) 을 사용한다면, 몽키패칭을 사용할 일은 거의 드물다.

한가지 예시를 들자면, JS는 DOM엘리먼트에 요소를 추가할 때 몽키패칭을 사용할 수 있다.

HTML의 DOM 요소의 id를 document의 프로퍼티로 접근할 수 있다.

```ts
// 이런 코드가 있다면..
<div id='yunseong'></div>;

// 스크립트 내에서 이렇게 접근 가능하다.
// index.js
document.yunseong;
```

알다시피 전역변수는 사용한다면 부수효과가 매우크다. 어떤 부수효과를 불러일으키는 지에 대한 예시는 따로 두지 않겠다.

여기에 TS까지 도입한다면 다른 문제도 발생한다.

document를 예시로 타입 체커는 Document 내장 속성은 알지만 임의로 추가한 속성에 대해 서는 알지 못한다.

```ts
document.yunseong = 'hello'; // Error
```

가장 간단한 방법은 역시 any를 사용하는 것이다.

```ts
(document as any).yunseong = 'hello';
```

당연히 단점은 타입 시스템을 사용하지 못한다는 것이다.

최선의 해결책은 document에서 데이터를 분리하는 것이다.

분리할 수 없는 경우가 있는데, (JS로된 코드를 마이그레이션 한다던지, 객체와 데이터가 붙어있어야만 라이브러리를 사용할 수 있는 경우. 이 경우는 잘 와닿지는 않는다)

이 경우에는 두가지 차선책이 존재한다.

## 보강(augmentation) 사용

타입스크립트에서 제공하는 타입 보강을 사용하는 것이다.

```ts
interface Document {
  yunseong: string;
}

document.cookie;
document.yunseong;
```

보강은 다음의 이점이 있다.

1. 주석을 붙일 수 있다.
   - 타입 선언에 주석을 붙이므로써 IDE가 추론 시 설명글을 볼 수 있다.
2. 속성에 자동완성을 사용할 수 있다.
3. 타입이 더 안전하다. 타입시스템이 실제로 타입을 체크하게 된다.
4. 몽키패치가 적용된 부분을 명시적으로 알 수 있다.

모듈을 사용하는 경우 각 모듈은 독립적인 스코프를 가지므로 제대로 동작하게 하려면 global 선언을 추가해야 한다.

당연히 global 선언을 했으므로 다른 모듈에서도 타입을 사용할 수 있다.

이는 특정 모듈에서만 몽키패칭한 타입을 사용하고 싶을 때는 사용할 수 없는 방법이다.

예시가 document 객체라 헷갈리는 부분이 있는데 몽키패칭의 관점에서만 살펴보자.

```ts
export {};
declare global {
  interface Document {
    yunseong: string;
  }
}
document.yunseong = 'hello';
```

## 구체적 단언 사용

특정 모듈에서만 몽키패칭한 타입을 사용하고 싶을 때는 구체적 단언을 사용하면 된다.

```ts
interface YunseongDoc extends Document {
  yunseong: string;
}

(document as YunseongDoc).yunseong = 'sdfsdf';
```

이러면 현재 모듈 내에서만 몽키패칭한 타입을 선언하고, 다른 모듈의 타입에는 영향을 끼치지 않는다.

다만 예시에서도 볼 수 있듯이 몽키패칭은 부수효과를 불러 일으키므로 주의해서 사용하자.
